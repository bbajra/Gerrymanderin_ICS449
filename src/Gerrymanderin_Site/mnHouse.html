<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
		<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
		<script src="data/mnprecinctparty.geojson"></script>
		<script src="data/mnPrecinctsMNHouseParty.geojson"></script>
		
		<style type="text/css">
				body{
					padding: 0;
					margin: 0;
				}
				html, body, #map { height : 100%; width : 100%;}
				.info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
				.legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
		</style>
	
	</head>
		<title>
		MN House
	</title>
	<body>
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
				<ul class="nav navbar-nav">
				<li class="nav-item"><a class="nav-link" href="index.php">Home</a></li>
				<li class="nav-item"><a class="nav-link" href="usCongress.html" class="btn btn-default"> U.S. Congress </a></li>
				<li class="nav-item"><a class="nav-link" href="presidential.html" class="btn btn-default">Presidential</a></li>
				<li class="nav-item"><a class="nav-link" href="mnSenate.html" class="btn btn-default">MN Senate</a></li>
				<li class="active"><a class="nav-link" href="mnHouse.html" class="btn btn-default"> MN House </a></li>
				<li class="nav-item"><a class="nav-link" href="#">Recommendation</a></li>
				</ul>
				<form action="http://www.google.com/search" class="navbar-form navbar-left" method="get" name="searchform" target="_blank">
					<input class="form-controls search" name="search" placeholder="Search in google" type="text">
					<button class="btn btn-default" type="submit">
					<i class="glyphicon glyphicon-search"></i>Search</button>
				</form>
			</div>
		</nav>
		<div id="map"></div>
		<script>
		/**
		* For GeoJson reference-properties: mnLegDistrict
		*/
		//Initializing the map
			var mapboxAccessToken = 'pk.eyJ1IjoiYmJhanJhIiwiYSI6ImNqY3Q2eDYycTBmZ3kyeHZ0ajZsNGtvajIifQ.tKzBEEfc7mCC0HmVy-KYuw';
			var map = L.map('map').setView([44.9375, -93.2010],14);
		
		//Loading the title layer
			L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
				//maxZoom: 90,
				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
					'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
				id: 'mapbox.light'
			}).addTo(map);
		
		//Loading geoJson from an external file
			var precinctLayer = L.geoJson(minnesota).addTo(map);
			map.fitBounds(precinctLayer.getBounds());
			
		// control that shows map information from GeoJson file when hovering
		var mapLayerInformation = L.control();

		mapLayerInformation.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'info');
			this.update();
			return this._div;
		};

		mapLayerInformation.update = function (props) {
			this._div.innerHTML = '<h4>Election Results: MN House</h4>' +  (props ?
				'<b>' + 'District:' + props.MNLegDist + '</b><br />' + 'County: ' + props.County + '</b><br/>' + 'Winning Party: ' + props.party
				+ '</b><br/>' + 'Total Voters: ' + props.TotalNumberOfVoters + '</b><br/>' + 'Republican Voters: ' + props.RepublicanVoters + '</b><br/>' + 'Democrat Voters: ' + props.DemocratVoters
				: 'Hover over an area');
		};

		mapLayerInformation.addTo(map);

		/*
		*Function to differentiate the districts by color
		*Add boundaries to the layer
		*/

		function getColor(district){
			//parsing district with regexStr since the districts are divided into 15A and 15B
			var regexStr = district.match(/[a-z]+|[^a-z]+/gi);
				if(regexStr[1]=='A'){
					return regexStr[0] % 10 ==1  ? '#800026' :
						regexStr[0] % 10 ==2 ? '#BD0026' :
						regexStr[0] % 10 ==3 ? '#FC4E2A' :
						regexStr[0] % 10 ==4 ? '#E31A1C' :
						regexStr[0] % 10 ==5 ? '#FD8D3C' :
						regexStr[0] % 10 ==6 ? '#2b8cbe' :
						regexStr[0] % 10 ==7 ? '#2ca25f' :
						regexStr[0] % 10 ==8 ? '#FFEDA0' :
						regexStr[0] % 10 ==9 ? '#004529' :
							   '#ff0000' ;
				} 
				if(regexStr[1]=='B'){
					return regexStr[0] % 10 ==8  ? '#800026' :
						regexStr[0] % 10 ==7 ? '#BD0026' :
						regexStr[0] % 10 ==6 ? '#FC4E2A' :
						regexStr[0] % 10 ==5 ? '#E31A1C' :
						regexStr[0] % 10 ==4 ? '#FD8D3C' :
						regexStr[0] % 10 ==3 ? '#2b8cbe' :
						regexStr[0] % 10 ==2 ? '#2ca25f' :
						regexStr[0] % 10 ==1 ? '#FFEDA0' :
						regexStr[0] % 10 ==0 ? '#004529' :
							   '#49006a' ;
				} 
				
		}
							
		function style(feature) {
			return {
				fillColor: getColor(feature.properties.MNLegDist),
				weight: 1,
				opacity: 1,
				color: 'black',
				dashArray: '0.5',
				fillOpacity: 0.7				
			};
		}
		/*
		* Adding interaction to map with hovering and zooming feature
		*/
		function highlightFeature(e) {
			var mapLayer = e.target;

			mapLayer.setStyle({
				weight: 5,
				color: '#330066',
				opacity: 0.9,
				dashArray: '',
				fillOpacity: 0.7
			});

			if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
				mapLayer.bringToFront();
			}

			mapLayerInformation.update(mapLayer.feature.properties);
		}
			
		var colorLayer;

		function resetHighlight(e) {
			colorLayer.resetStyle(e.target);
			mapLayerInformation.update();
		}

		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds());
		}

		function onEachFeature(feature, mapLayer) {
			mapLayer.on({
				mouseover: highlightFeature,
				mouseout: resetHighlight,
				click: zoomToFeature
			});
		}
		/*
		* Adding two layers to the map
		*/

		var colorLayer = L.geoJson(minnesota, {
			style: style,
			onEachFeature: onEachFeature
			}).addTo(map);
		
		function secondLayerFeature(feature, mapLayer) {
			mapLayer.on({
				mouseover: mouseoverSecondLayer
			});
		}
		function mouseoverSecondLayer(e) {
			var mapSecondLayer = e.target;

			if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
				mapSecondLayer.bringToFront();
			}

			mapLayerInformation.update(mapSecondLayer.feature.properties);
		}

		
		var partyLayer = L.geoJson(mn, {
			style: function(feature) {
				var blue = ['#f7fbff','#deebf7','#c6dbef','#9ecae1','#6baed6','#4292c6','#2171b5','#08519c','#08306b'];
				var red = ['#fff5f0','#fee0d2','#fcbba1','#fc9272','#fb6a4a','#ef3b2c','#cb181d','#a50f15','#67000d'];
				//var district = feature.properties.cityComDistrict;
				/**switch (feature.properties.party){
					case "Republican" : return feature.properties.cityComDistrict % 10 ==1 ? red[0] :
												feature.properties.cityComDistrict % 10 ==2 ? red[1] :
												feature.properties.cityComDistrict % 10 ==3 ? red[2] :
												feature.properties.cityComDistrict % 10 ==4 ? red[3] :
												feature.properties.cityComDistrict % 10 ==5 ? red[4] :
												feature.properties.cityComDistrict % 10 ==6 ? red[5] :
												feature.properties.cityComDistrict % 10 ==7 ? red[6] :
												feature.properties.cityComDistrict % 10 ==8 ? red[7] :
																red[8] ;
					case "Democrat" : return feature.properties.cityComDistrict % 10 ==1 ? blue[0] :
												feature.properties.cityComDistrict % 10 ==2 ? blue[1] :
												feature.properties.cityComDistrict % 10 ==3 ? blue[2] :
												feature.properties.cityComDistrict % 10 ==4 ? blue[3] :
												feature.properties.cityComDistrict % 10 ==5 ? blue[4] :
												feature.properties.cityComDistrict % 10 ==6 ? blue[5] :
												feature.properties.cityComDistrict % 10 ==7 ? blue[6] :
												feature.properties.cityComDistrict % 10 ==8 ? blue[7] :
																blue[8] ;
					}*/
					if (feature.properties.party == "Republican"){
						switch (feature.properties.MNLegDist){
							case '1' : return {color: red[0]};
							case '2' : return {color: red[1]};
							case '3' : return {color: red[2]};
							case '4' : return {color: red[3]};
							case '5' : return {color: red[4]};
							case '6' : return {color: red[5]};
							case '7' : return {color: red[6]};
							case '8' : return {color: red[7]};
							case '0' : return {color: red[8]};
						}
					}
					if (feature.properties.party == "Democrat"){
						switch (feature.properties.MNLegDist){
							case '1' : return {color: blue[0]};
							case '2' : return {color: blue[1]};
							case '3' : return {color: blue[2]};
							case '4' : return {color: blue[3]};
							case '5' : return {color: blue[4]};
							case '6' : return {color: blue[5]};
							case '7' : return {color: blue[6]};
							case '8' : return {color: blue[7]};
							case '0' : return {color: blue[8]};
						}
					}
			},
			weight: 1,
			opacity: 0.8,
			color: '',
			dashArray: '0.3',
			fillOpacity: 0.8,
			onEachFeature: secondLayerFeature
			}).addTo(map);

		var basemaps = {
			"District map": colorLayer,
			"Election map": partyLayer
		};


		L.control.layers(basemaps, {}, {collapsed: false}).addTo(map);
		</script>
	</body>
</html>
